# AI Document Extraction & PDF Filling Solution - Implementation Plan

## Project Overview

A browser-only React PWA that automates real estate agent workflows by:
- Extracting structured data from client documents (passports, property docs, contacts) using local AI
- Auto-filling PDF contract templates with extracted information
- All processing happens locally in the browser (no backend, full privacy)

## Technology Stack

### Core Framework
- **React 19.2.3** with **Vite** (migrating from CRA for better performance)
- **Zustand** for state management
- **React Router v6** for navigation
- **Tailwind CSS + shadcn/ui** for UI components

### AI & ML
- **WebLLM** - Document classification & structured extraction (Phi-3-mini default)
- **ONNX Runtime Web** - CommonForms model for PDF form field detection
- **Tesseract.js** - OCR for scanned images/documents

### PDF Processing
- **pdfme** - Template creation, field mapping, PDF generation
- **PDF.js** - Text extraction from PDFs

### Storage
- **IndexedDB** (via Dexie.js) - Client data, documents, models, templates, mappings
- **Browser Cache API** - AI model caching (WebLLM)

### Deployment
- Progressive Web App (PWA) with offline support
- Requires **Chrome 113+ or Edge 113+** (WebGPU requirement)

---

## High-Level Architecture

### Component Hierarchy
```
App
├── BrowserCapabilityProvider (WebGPU detection)
├── IndexedDBProvider (Database initialization)
├── AIModelProvider (Model management)
├── AppStateProvider (Zustand stores)
├── Layout (Header, Sidebar, MainContent)
└── Routes
    ├── Dashboard
    ├── ClientManagement
    │   ├── ClientList
    │   ├── ClientDetail (with DocumentUploader, DocumentList)
    │   └── ClientCreator
    ├── DocumentProcessing
    │   ├── ProcessingQueue
    │   ├── ExtractionResults (JSON viewer)
    │   └── ClassificationOverview
    ├── TemplateMappingWorkflow
    │   ├── TemplateUploader
    │   ├── FieldDetection (CommonForms visualization)
    │   ├── MappingEditor (AI suggestions + manual drag-drop)
    │   └── PDFGenerator
    └── Settings (Model management, storage monitor)
```

### Data Flow
```
Document Upload → Text Extraction (PDF.js/Tesseract) →
AI Classification (WebLLM) → Structured Extraction (WebLLM JSON mode) →
Store in IndexedDB → Template Mapping → PDF Generation (pdfme)
```

### Folder Structure
```
my-app/
├── src/
│   ├── components/
│   │   ├── common/ (Button, Card, FileUploader, Modal, etc.)
│   │   ├── layout/ (Header, Sidebar, MainLayout)
│   │   ├── client/ (ClientCard, ClientForm, ClientList)
│   │   ├── document/ (DocumentUploader, DocumentViewer, ExtractionResults)
│   │   ├── template/ (TemplateDesigner, FieldDetector, MappingEditor)
│   │   └── settings/ (ModelDownloader, StorageMonitor)
│   ├── pages/ (Dashboard, ClientDetail, DocumentProcessing, etc.)
│   ├── services/
│   │   ├── ai/ (webllm, onnx, extraction, classification services)
│   │   ├── pdf/ (pdfme, pdfjs, fieldMapping services)
│   │   ├── ocr/ (tesseract service)
│   │   ├── storage/ (indexedDB, client, document, model, template storage)
│   │   └── browser/ (capability, worker services)
│   ├── workers/ (ai.worker, ocr.worker, pdf.worker, onnx.worker)
│   ├── stores/ (clientStore, documentStore, modelStore, templateStore, uiStore)
│   ├── hooks/ (useAI, useDocumentUpload, useIndexedDB, useModelLoader, etc.)
│   ├── utils/ (constants, fileHelpers, schemaHelpers, validators)
│   └── App.jsx
├── public/ (manifest.json, service-worker.js)
└── vite.config.js
```

---

## IndexedDB Schema

### Object Stores

#### 1. `clients`
```javascript
{
  id: uuid,
  name: string,
  description: string,
  createdAt: timestamp,
  updatedAt: timestamp,
  metadata: object
}
indexes: ['createdAt', 'name']
```

#### 2. `documents`
```javascript
{
  id: uuid,
  clientId: uuid,
  fileName: string,
  fileType: 'pdf' | 'image' | 'text',
  fileSize: number,
  fileBlob: Blob,
  uploadedAt: timestamp,
  status: 'pending' | 'processing' | 'completed' | 'failed',
  documentType: 'passport' | 'property' | 'contact' | 'invoice' | 'contract' | 'other',
  extractedText: string,
  extractedData: object,
  jsonSchema: object,
  processingError: string?,
  metadata: object
}
indexes: ['clientId', 'status', 'uploadedAt', 'documentType']
```

#### 3. `templates`
```javascript
{
  id: uuid,
  name: string,
  description: string,
  pdfBlob: Blob,
  pdfmeSchema: object,
  detectedFields: array,
  createdAt: timestamp,
  updatedAt: timestamp
}
indexes: ['name', 'createdAt']
```

#### 4. `field_mappings`
```javascript
{
  id: uuid,
  templateId: uuid,
  clientId: uuid?,
  mappings: [{ templateField, documentField, confidence }],
  isAutoGenerated: boolean,
  createdAt: timestamp,
  updatedAt: timestamp
}
indexes: ['templateId', 'clientId']
```

#### 5. `ai_models`
```javascript
{
  modelId: string,
  type: 'llm' | 'onnx',
  name: string,
  displayName: string,
  size: number,
  status: 'not_downloaded' | 'downloading' | 'ready' | 'error',
  downloadProgress: number,
  modelData: Blob,
  config: object,
  downloadedAt: timestamp?
}
indexes: ['type', 'status']
```

#### 6. `processing_jobs`
```javascript
{
  id: uuid,
  documentId: uuid,
  jobType: 'extraction' | 'classification' | 'ocr' | 'field_detection',
  status: 'queued' | 'running' | 'completed' | 'failed',
  progress: number,
  result: object?,
  error: string?,
  createdAt: timestamp,
  startedAt: timestamp?,
  completedAt: timestamp?
}
indexes: ['documentId', 'status', 'createdAt']
```

#### 7. `app_settings`
```javascript
{
  key: string,
  value: any,
  updatedAt: timestamp
}
```

---

## Key Technical Decisions

### 1. Build System: Migrate to Vite
**Why:** Better Web Worker support, faster HMR, better WASM/WebGPU handling, smaller bundles, CRA in maintenance mode

### 2. State Management: Zustand
**Why:** Lightweight, no boilerplate, better performance than Context API, excellent TypeScript support

### 3. UI Library: shadcn/ui + Tailwind
**Why:** Copy-paste components (full control), headless UI (Radix), accessibility built-in, customizable

### 4. Web Workers Strategy
**Critical for performance** - Use workers for:
- AI inference (WebLLM) - long-running
- OCR (Tesseract.js) - CPU-intensive
- PDF text extraction (PDF.js) - medium-intensity
- Field detection (ONNX Runtime) - GPU/WASM

### 5. Browser Support
**Target:** Chrome 113+ and Edge 113+ (WebGPU required)
**Unsupported:** Safari, Firefox (WebGPU not yet available)
Show compatibility warning and redirect to `/unsupported` page

---

## AI Processing Pipeline

### Document Classification
```javascript
// Input: Extracted text (first 2000 chars)
// Output: { type: 'passport', confidence: 0.95 }

const systemPrompt = `Classify document into: passport, property_deed,
contact_info, invoice, contract, other. Return JSON with type and confidence.`

const response = await webllm.chat.completions.create({
  messages: [
    { role: "system", content: systemPrompt },
    { role: "user", content: extractedText }
  ],
  response_format: { type: "json_object" }
})
```

### Structured Extraction
```javascript
// Input: Full text + document type
// Output: { data: {...}, schema: {...} }

const schemas = {
  passport: {
    fullName: string,
    passportNumber: string,
    nationality: string,
    dateOfBirth: string,
    expiryDate: string
  },
  property: {
    address: string,
    propertyType: string,
    size: string,
    ownerName: string,
    registrationNumber: string
  },
  // ... other schemas
}

const response = await webllm.chat.completions.create({
  messages: [
    { role: "system", content: `Extract data matching schema: ${schema}` },
    { role: "user", content: fullText }
  ],
  response_format: { type: "json_object" }
})
```

### Field Mapping Auto-Suggestion
```javascript
// Input: Template fields + extracted data
// Output: [{ templateField, documentField, confidence }]

const response = await webllm.suggestFieldMapping(
  ['client_name', 'passport_id', 'property_address'],
  { fullName: 'John Doe', passportNumber: 'AB123456', address: '123 Main St' }
)

// Enhanced with fuzzy matching
const fuzzyScore = levenshteinDistance('client_name', 'fullName')
const finalConfidence = (aiConfidence + fuzzyScore) / 2
```

---

## PDF Workflow

### 1. Template Upload
- User uploads PDF contract template
- Store in `templates` object store (pdfBlob + metadata)
- Convert to pdfme template format

### 2. Field Detection (CommonForms Model)
```javascript
// Render PDF pages as images
const pages = await renderPDFPages(pdfBlob)

// Run ONNX model on each page
for (const page of pages) {
  const detections = await onnxService.detectFormFields(page)
  // detections: [{ x, y, width, height, fieldType, confidence }]
}

// Convert to pdfme schema format
const pdfmeFields = detections.map(det => ({
  type: 'text',
  position: { x: det.x, y: det.y },
  width: det.width,
  height: det.height,
  name: `field_${det.x}_${det.y}`
}))
```

### 3. AI-Assisted Mapping
- AI suggests mappings: `client_name → fullName (0.92 confidence)`
- Show confidence indicator (color-coded)
- Auto-accept high confidence (>0.7)
- Manual editor for low confidence or corrections

### 4. Mapping Editor (Drag-Drop UI)
```
Template Fields          Extracted Data
┌─────────────┐         ┌──────────────┐
│ client_name │◄────────│ fullName     │
│ passport_id │         │ passportNum  │
│ address     │         │ address      │
└─────────────┘         └──────────────┘

AI Suggestions (70% confidence or lower)
┌──────────────────────────────────────┐
│ property_type → propertyType (0.65)  │
│ [Accept] [Reject]                    │
└──────────────────────────────────────┘
```

### 5. PDF Generation
```javascript
const mappedData = applyMappings(template.mappings, extractedData)

const pdf = await pdfme.generate({
  template: template.pdfmeSchema,
  inputs: [mappedData]
})

// Download or preview
const blob = new Blob([pdf.buffer], { type: 'application/pdf' })
```

---

## Performance Considerations

### Model Download Times
- Phi-3-mini (1.6GB): ~3-10 min on average connection
- CommonForms model (~50MB): ~30-60 sec
- **Strategy:** Show progress bar, allow background download, cache in browser

### Inference Performance
- Classification: ~5-10 seconds
- Extraction: ~10-30 seconds
- Field mapping: ~5-10 seconds
- **Optimization:** Limit context to 2000-4000 tokens, use Web Workers

### Storage Limits
- IndexedDB quota: ~60% of disk space (10-50GB typical)
- 1000 documents ≈ 5GB + extracted data
- **Monitoring:** Check quota at 60% (warning), 80% (critical)
- **Cleanup:** Auto-delete jobs >30 days, compress text, export old clients

### Bundle Size
- Target: <500KB initial bundle
- Code splitting by route
- Lazy load pdfme designer
- Tree-shake unused components

---

## Implementation Phases & Tickets

### Phase 1: Foundation & Infrastructure (Week 1-2)

**Critical Files:**
- [vite.config.js](my-app/vite.config.js) - NEW
- [src/services/storage/indexedDB.service.js](my-app/src/services/storage/indexedDB.service.js) - NEW
- [src/stores/index.js](my-app/src/stores/index.js) - NEW
- [src/services/browser/capability.service.js](my-app/src/services/browser/capability.service.js) - NEW
- [src/App.jsx](my-app/src/App.jsx) - MODIFY

#### Ticket 1.1: Migrate from CRA to Vite
- [ ] Install Vite and @vitejs/plugin-react
- [ ] Create vite.config.js with Web Worker support, WebGPU target
- [ ] Move index.html to root directory
- [ ] Update package.json scripts (dev, build, preview)
- [ ] Configure worker format as 'es'
- [ ] Test dev server and production build

**Dependencies:**
```bash
npm install -D vite @vitejs/plugin-react
```

#### Ticket 1.2: Install Core Dependencies
```bash
npm install zustand react-router-dom dexie uuid date-fns
npm install @mlc-ai/web-llm onnxruntime-web
npm install @pdfme/ui @pdfme/generator
npm install pdfjs-dist tesseract.js
```

#### Ticket 1.3: Set Up Tailwind CSS + shadcn/ui
- [ ] Install Tailwind CSS
- [ ] Initialize shadcn/ui
- [ ] Add base components: Button, Card, Dialog, Form, Progress, Toast
- [ ] Create theme configuration

```bash
npm install -D tailwindcss postcss autoprefixer
npx tailwindcss init -p
npx shadcn-ui@latest init
npx shadcn-ui@latest add button card dialog form progress toast
```

#### Ticket 1.4: Implement IndexedDB Schema with Dexie
- [ ] Create indexedDB.service.js
- [ ] Define all 7 object stores (clients, documents, templates, field_mappings, ai_models, processing_jobs, app_settings)
- [ ] Add indexes for efficient queries
- [ ] Implement CRUD helpers for each store
- [ ] Add database version management
- [ ] Test database initialization

**File:** [src/services/storage/indexedDB.service.js](my-app/src/services/storage/indexedDB.service.js)

#### Ticket 1.5: Create Zustand Stores
- [ ] Create clientStore (clients, CRUD actions)
- [ ] Create documentStore (documents, processing status)
- [ ] Create modelStore (AI models, download progress)
- [ ] Create templateStore (PDF templates, mappings)
- [ ] Create uiStore (modals, toasts, loading states)
- [ ] Configure devtools middleware
- [ ] Test store actions

**File:** [src/stores/index.js](my-app/src/stores/index.js)

#### Ticket 1.6: Browser Capability Detection
- [ ] Create capability.service.js
- [ ] Implement checkWebGPUSupport()
- [ ] Implement checkIndexedDBSupport()
- [ ] Implement checkRequirements() (WebGPU + IndexedDB + Workers)
- [ ] Return detailed error messages for unsupported browsers
- [ ] Test on Chrome 113+, Edge 113+, Safari (should fail), Firefox (should fail)

**File:** [src/services/browser/capability.service.js](my-app/src/services/browser/capability.service.js)

#### Ticket 1.7: Set Up Routing Structure
- [ ] Install React Router v6
- [ ] Create MainLayout component (Header, Sidebar, MainContent)
- [ ] Define routes: /, /clients, /clients/:id, /documents/:id, /templates, /settings, /onboarding, /unsupported
- [ ] Add BrowserRouter and Routes in App.jsx
- [ ] Create placeholder page components
- [ ] Test navigation

**Files:**
- [src/App.jsx](my-app/src/App.jsx)
- [src/components/layout/MainLayout.jsx](my-app/src/components/layout/MainLayout.jsx) - NEW
- [src/pages/Dashboard.jsx](my-app/src/pages/Dashboard.jsx) - NEW

#### Ticket 1.8: Create Base Layout Components
- [ ] Build Header component (logo, navigation, model status indicator, storage usage)
- [ ] Build Sidebar component (client list, quick actions)
- [ ] Build MainLayout component (responsive grid)
- [ ] Add Tailwind styling
- [ ] Test responsive behavior

**Files:**
- [src/components/layout/Header.jsx](my-app/src/components/layout/Header.jsx) - NEW
- [src/components/layout/Sidebar.jsx](my-app/src/components/layout/Sidebar.jsx) - NEW

#### Ticket 1.9: Create Unsupported Browser Page
- [ ] Create UnsupportedBrowser component
- [ ] Show error message: "WebGPU required. Use Chrome 113+ or Edge 113+"
- [ ] Provide browser download links
- [ ] Add capability detection in App.jsx, redirect if incompatible

**File:** [src/pages/UnsupportedBrowser.jsx](my-app/src/pages/UnsupportedBrowser.jsx) - NEW

---

### Phase 2: Client & Document Management (Week 3)

**Critical Files:**
- [src/pages/ClientList.jsx](my-app/src/pages/ClientList.jsx) - NEW
- [src/pages/ClientDetail.jsx](my-app/src/pages/ClientDetail.jsx) - NEW
- [src/components/client/ClientForm.jsx](my-app/src/components/client/ClientForm.jsx) - NEW
- [src/components/document/DocumentUploader.jsx](my-app/src/components/document/DocumentUploader.jsx) - NEW
- [src/services/storage/clientStorage.service.js](my-app/src/services/storage/clientStorage.service.js) - NEW
- [src/services/storage/documentStorage.service.js](my-app/src/services/storage/documentStorage.service.js) - NEW

#### Ticket 2.1: Client CRUD Operations
- [ ] Create clientStorage.service.js (create, read, update, delete, list)
- [ ] Connect to clientStore
- [ ] Test CRUD operations with IndexedDB

**File:** [src/services/storage/clientStorage.service.js](my-app/src/services/storage/clientStorage.service.js)

#### Ticket 2.2: Build Client List Page
- [ ] Create ClientList component
- [ ] Display clients in grid/list view
- [ ] Add "Create Client" button
- [ ] Show client metadata (name, created date, document count)
- [ ] Add search/filter functionality
- [ ] Link to client detail page

**File:** [src/pages/ClientList.jsx](my-app/src/pages/ClientList.jsx)

#### Ticket 2.3: Build Client Creation Form
- [ ] Create ClientForm component
- [ ] Add form fields: name, description, metadata
- [ ] Validate inputs
- [ ] Connect to clientStore.createClient()
- [ ] Show success toast on creation
- [ ] Redirect to client detail page

**File:** [src/components/client/ClientForm.jsx](my-app/src/components/client/ClientForm.jsx)

#### Ticket 2.4: Build Client Detail Page
- [ ] Create ClientDetail component
- [ ] Display client info (editable)
- [ ] Show document list (placeholder for now)
- [ ] Add "Upload Documents" area
- [ ] Add "Delete Client" button with confirmation
- [ ] Test navigation from ClientList

**File:** [src/pages/ClientDetail.jsx](my-app/src/pages/ClientDetail.jsx)

#### Ticket 2.5: Build Multi-File Uploader
- [ ] Create DocumentUploader component
- [ ] Add drag-and-drop zone
- [ ] Support multiple file selection
- [ ] Validate file types (PDF, JPG, PNG, TXT only)
- [ ] Limit file size (50MB per file)
- [ ] Show upload progress for each file
- [ ] Store files in documentStore (status: 'pending')

**File:** [src/components/document/DocumentUploader.jsx](my-app/src/components/document/DocumentUploader.jsx)

#### Ticket 2.6: Document Storage Service
- [ ] Create documentStorage.service.js
- [ ] Implement createDocument(clientId, file)
- [ ] Store fileBlob, fileName, fileType, fileSize
- [ ] Generate UUID for document ID
- [ ] Link to clientId
- [ ] Test file storage and retrieval

**File:** [src/services/storage/documentStorage.service.js](my-app/src/services/storage/documentStorage.service.js)

#### Ticket 2.7: Build Document List Component
- [ ] Create DocumentList component
- [ ] Display documents for current client
- [ ] Show file name, type, size, upload date, status
- [ ] Add file type icons (PDF, image, text)
- [ ] Color-code status (pending, processing, completed, failed)
- [ ] Add "View" and "Delete" actions
- [ ] Test with uploaded files

**File:** [src/components/document/DocumentList.jsx](my-app/src/components/document/DocumentList.jsx)

#### Ticket 2.8: File Type Detection
- [ ] Create fileHelpers.js utility
- [ ] Implement detectFileType(file) → 'pdf' | 'image' | 'text'
- [ ] Check MIME type and file extension
- [ ] Add validation for allowed types
- [ ] Test with various file types

**File:** [src/utils/fileHelpers.js](my-app/src/utils/fileHelpers.js)

---

### Phase 3: Text Extraction Pipeline (Week 4)

**Critical Files:**
- [src/services/pdf/pdfjs.service.js](my-app/src/services/pdf/pdfjs.service.js) - NEW
- [src/services/ocr/tesseract.service.js](my-app/src/services/ocr/tesseract.service.js) - NEW
- [src/workers/pdf.worker.js](my-app/src/workers/pdf.worker.js) - NEW
- [src/workers/ocr.worker.js](my-app/src/workers/ocr.worker.js) - NEW
- [src/components/document/DocumentViewer.jsx](my-app/src/components/document/DocumentViewer.jsx) - NEW

#### Ticket 3.1: PDF.js Text Extraction Service
- [ ] Create pdfjs.service.js
- [ ] Implement extractTextFromPDF(pdfBlob)
- [ ] Use PDF.js to parse PDF
- [ ] Extract text from all pages
- [ ] Combine into single string
- [ ] Handle errors (corrupted PDFs)
- [ ] Test with sample PDFs

**File:** [src/services/pdf/pdfjs.service.js](my-app/src/services/pdf/pdfjs.service.js)

#### Ticket 3.2: PDF.js Web Worker
- [ ] Create pdf.worker.js
- [ ] Move PDF.js processing to worker
- [ ] Handle 'EXTRACT_TEXT' message type
- [ ] Post progress updates
- [ ] Post result or error
- [ ] Test worker communication

**File:** [src/workers/pdf.worker.js](my-app/src/workers/pdf.worker.js)

#### Ticket 3.3: Tesseract.js OCR Service
- [ ] Create tesseract.service.js
- [ ] Implement extractTextFromImage(imageBlob)
- [ ] Configure Tesseract.js (language: 'eng')
- [ ] Handle progress callbacks
- [ ] Return extracted text
- [ ] Test with sample images (passport photo, scanned doc)

**File:** [src/services/ocr/tesseract.service.js](my-app/src/services/ocr/tesseract.service.js)

#### Ticket 3.4: OCR Web Worker
- [ ] Create ocr.worker.js
- [ ] Move Tesseract.js to worker
- [ ] Handle 'EXTRACT_TEXT' message
- [ ] Post progress updates
- [ ] Post result or error
- [ ] Test with images

**File:** [src/workers/ocr.worker.js](my-app/src/workers/ocr.worker.js)

#### Ticket 3.5: useWebWorker Hook
- [ ] Create useWebWorker.js hook
- [ ] Initialize worker from path
- [ ] Implement execute(type, payload) method
- [ ] Track status: 'idle' | 'running' | 'success' | 'error'
- [ ] Handle worker termination on unmount
- [ ] Return { execute, status }

**File:** [src/hooks/useWebWorker.js](my-app/src/hooks/useWebWorker.js)

#### Ticket 3.6: Extraction Orchestration Service
- [ ] Create extraction.service.js
- [ ] Implement processDocument(documentId)
- [ ] Detect file type
- [ ] Route to PDF.js or Tesseract worker
- [ ] Update document.extractedText in IndexedDB
- [ ] Update document.status to 'completed' or 'failed'
- [ ] Handle errors

**File:** [src/services/ai/extraction.service.js](my-app/src/services/ai/extraction.service.js)

#### Ticket 3.7: Build Document Viewer Component
- [ ] Create DocumentViewer component
- [ ] Display document metadata
- [ ] Show extracted text in scrollable area
- [ ] Add "Reprocess" button
- [ ] Show processing status/errors
- [ ] Test with processed documents

**File:** [src/components/document/DocumentViewer.jsx](my-app/src/components/document/DocumentViewer.jsx)

#### Ticket 3.8: Processing Queue UI
- [ ] Create ProcessingQueue component
- [ ] List all documents with status
- [ ] Show progress bars for active jobs
- [ ] Auto-refresh on status changes
- [ ] Add "Process All" button
- [ ] Test with multiple documents

**File:** [src/components/document/ProcessingQueue.jsx](my-app/src/components/document/ProcessingQueue.jsx)

---

### Phase 4: AI Model Management (Week 5)

**Critical Files:**
- [src/services/ai/webllm.service.js](my-app/src/services/ai/webllm.service.js) - NEW
- [src/components/settings/ModelDownloader.jsx](my-app/src/components/settings/ModelDownloader.jsx) - NEW
- [src/pages/OnboardingWizard.jsx](my-app/src/pages/OnboardingWizard.jsx) - NEW
- [src/services/storage/modelStorage.service.js](my-app/src/services/storage/modelStorage.service.js) - NEW

#### Ticket 4.1: Model Storage Service
- [ ] Create modelStorage.service.js
- [ ] Implement addModel(modelId, config)
- [ ] Implement updateModelStatus(modelId, status, progress)
- [ ] Implement getModel(modelId)
- [ ] Implement listModels()
- [ ] Test CRUD operations

**File:** [src/services/storage/modelStorage.service.js](my-app/src/services/storage/modelStorage.service.js)

#### Ticket 4.2: WebLLM Service Initialization
- [ ] Create webllm.service.js
- [ ] Implement initialize(modelId)
- [ ] Use @mlc-ai/web-llm CreateMLCEngine()
- [ ] Track initialization state
- [ ] Handle initProgressCallback
- [ ] Update modelStore with download progress
- [ ] Test with Phi-3-mini model

**File:** [src/services/ai/webllm.service.js](my-app/src/services/ai/webllm.service.js)

#### Ticket 4.3: Model Configuration Constants
- [ ] Create constants.js
- [ ] Define available models:
  - Phi-3-mini-4k-instruct (default, 1.6GB)
  - Llama-3-8B-Instruct (4.7GB)
  - Gemma-2B (2.5GB)
- [ ] Add model metadata (size, description, speed)
- [ ] Define document type schemas

**File:** [src/utils/constants.js](my-app/src/utils/constants.js)

#### Ticket 4.4: Build Model Downloader Component
- [ ] Create ModelDownloader component
- [ ] List available models (from constants)
- [ ] Show model size, description
- [ ] Add "Download" button for each model
- [ ] Show progress bar during download
- [ ] Disable download if already downloading
- [ ] Mark as "Ready" when complete
- [ ] Test download flow

**File:** [src/components/settings/ModelDownloader.jsx](my-app/src/components/settings/ModelDownloader.jsx)

#### Ticket 4.5: Model Status Indicator in Header
- [ ] Update Header component
- [ ] Show current active model
- [ ] Display status: "Ready" (green), "Downloading" (yellow), "Not Loaded" (red)
- [ ] Add click to open model settings
- [ ] Test status changes

**File:** [src/components/layout/Header.jsx](my-app/src/components/layout/Header.jsx)

#### Ticket 4.6: Build Onboarding Wizard
- [ ] Create OnboardingWizard component
- [ ] Step 1: Welcome + browser compatibility check
- [ ] Step 2: Model selection and download
- [ ] Step 3: Quick tutorial
- [ ] Save onboarding completion in app_settings
- [ ] Redirect to dashboard after completion
- [ ] Test full onboarding flow

**File:** [src/pages/OnboardingWizard.jsx](my-app/src/pages/OnboardingWizard.jsx)

#### Ticket 4.7: First Launch Detection
- [ ] Check app_settings for 'onboardingCompleted'
- [ ] Redirect to /onboarding if not completed
- [ ] Add in App.jsx useEffect
- [ ] Test first launch vs returning user

**File:** [src/App.jsx](my-app/src/App.jsx)

---

### Phase 5: AI Classification & Extraction (Week 6-7)

**Critical Files:**
- [src/workers/ai.worker.js](my-app/src/workers/ai.worker.js) - NEW
- [src/services/ai/classification.service.js](my-app/src/services/ai/classification.service.js) - NEW
- [src/components/document/ExtractionResults.jsx](my-app/src/components/document/ExtractionResults.jsx) - NEW

#### Ticket 5.1: Document Type Schemas
- [ ] Define JSON schemas in constants.js for:
  - passport (fullName, passportNumber, nationality, dateOfBirth, expiryDate)
  - property (address, propertyType, size, ownerName, registrationNumber)
  - contact (name, email, phone, address)
  - invoice (invoiceNumber, date, amount, vendor)
  - contract (parties, date, terms)
  - other (generic key-value pairs)
- [ ] Test schema validation

**File:** [src/utils/constants.js](my-app/src/utils/constants.js)

#### Ticket 5.2: WebLLM Classification Method
- [ ] Add classifyDocument(text) to webllm.service.js
- [ ] Create system prompt for classification
- [ ] Use JSON mode for response
- [ ] Return { type, confidence }
- [ ] Test with sample documents
- [ ] Handle errors

**File:** [src/services/ai/webllm.service.js](my-app/src/services/ai/webllm.service.js)

#### Ticket 5.3: WebLLM Extraction Method
- [ ] Add extractStructuredData(text, documentType) to webllm.service.js
- [ ] Load schema for documentType
- [ ] Create system prompt with schema
- [ ] Use JSON mode for response
- [ ] Return { data, schema }
- [ ] Test with sample documents
- [ ] Handle errors

**File:** [src/services/ai/webllm.service.js](my-app/src/services/ai/webllm.service.js)

#### Ticket 5.4: AI Worker Implementation
- [ ] Create ai.worker.js
- [ ] Import webllm.service
- [ ] Handle 'CLASSIFY' message → classifyDocument()
- [ ] Handle 'EXTRACT' message → extractStructuredData()
- [ ] Handle 'SUGGEST_MAPPING' message (placeholder for now)
- [ ] Post progress updates
- [ ] Post results or errors
- [ ] Test worker communication

**File:** [src/workers/ai.worker.js](my-app/src/workers/ai.worker.js)

#### Ticket 5.5: Classification Service
- [ ] Create classification.service.js
- [ ] Implement classifyDocument(documentId)
- [ ] Get extractedText from IndexedDB
- [ ] Send to AI worker
- [ ] Update document.documentType and confidence
- [ ] Update document.status
- [ ] Test classification flow

**File:** [src/services/ai/classification.service.js](my-app/src/services/ai/classification.service.js)

#### Ticket 5.6: Extraction Service Enhancement
- [ ] Update extraction.service.js
- [ ] Add extractStructuredData(documentId) method
- [ ] Get extractedText and documentType
- [ ] Send to AI worker
- [ ] Update document.extractedData and jsonSchema
- [ ] Test extraction flow

**File:** [src/services/ai/extraction.service.js](my-app/src/services/ai/extraction.service.js)

#### Ticket 5.7: Processing Job Queue
- [ ] Create processing job records in processing_jobs store
- [ ] Link jobs to documents
- [ ] Track status: queued → running → completed/failed
- [ ] Implement job queue with concurrency limit (max 2 AI jobs)
- [ ] Update ProcessingQueue component to show jobs
- [ ] Test queue behavior

**File:** [src/services/ai/jobQueue.service.js](my-app/src/services/ai/jobQueue.service.js) - NEW

#### Ticket 5.8: Build Extraction Results Component
- [ ] Create ExtractionResults component
- [ ] Display JSON data in formatted view
- [ ] Show schema on the side
- [ ] Add "Edit" button for manual corrections
- [ ] Add "Re-extract" button
- [ ] Show confidence scores
- [ ] Test with extracted documents

**File:** [src/components/document/ExtractionResults.jsx](my-app/src/components/document/ExtractionResults.jsx)

#### Ticket 5.9: Full Processing Pipeline Integration
- [ ] Integrate text extraction → classification → structured extraction
- [ ] Update ProcessingQueue to trigger full pipeline
- [ ] Add "Process All Documents" button
- [ ] Show step-by-step progress for each document
- [ ] Test end-to-end flow

**File:** [src/services/ai/processingPipeline.service.js](my-app/src/services/ai/processingPipeline.service.js) - NEW

---

### Phase 6: PDF Template System (Week 8)

**Critical Files:**
- [src/services/pdf/pdfme.service.js](my-app/src/services/pdf/pdfme.service.js) - NEW
- [src/components/template/TemplateUploader.jsx](my-app/src/components/template/TemplateUploader.jsx) - NEW
- [src/pages/TemplateList.jsx](my-app/src/pages/TemplateList.jsx) - NEW
- [src/services/storage/templateStorage.service.js](my-app/src/services/storage/templateStorage.service.js) - NEW

#### Ticket 6.1: Template Storage Service
- [ ] Create templateStorage.service.js
- [ ] Implement createTemplate(name, pdfBlob, pdfmeSchema)
- [ ] Implement getTemplate(templateId)
- [ ] Implement listTemplates()
- [ ] Implement updateTemplate(templateId, updates)
- [ ] Implement deleteTemplate(templateId)
- [ ] Test CRUD operations

**File:** [src/services/storage/templateStorage.service.js](my-app/src/services/storage/templateStorage.service.js)

#### Ticket 6.2: pdfme Service - Template Creation
- [ ] Create pdfme.service.js
- [ ] Implement createTemplateFromPDF(pdfBlob)
- [ ] Convert PDF to pdfme template format
- [ ] Return base template structure
- [ ] Test with sample PDF templates

**File:** [src/services/pdf/pdfme.service.js](my-app/src/services/pdf/pdfme.service.js)

#### Ticket 6.3: Build Template Uploader Component
- [ ] Create TemplateUploader component
- [ ] Add file upload (PDF only)
- [ ] Show template preview
- [ ] Add name and description fields
- [ ] Save template to IndexedDB
- [ ] Test upload flow

**File:** [src/components/template/TemplateUploader.jsx](my-app/src/components/template/TemplateUploader.jsx)

#### Ticket 6.4: Build Template List Page
- [ ] Create TemplateList component
- [ ] Display all templates in grid
- [ ] Show template name, creation date, thumbnail
- [ ] Add "Upload Template" button
- [ ] Add "Edit" and "Delete" actions
- [ ] Link to mapping workflow
- [ ] Test template management

**File:** [src/pages/TemplateList.jsx](my-app/src/pages/TemplateList.jsx)

#### Ticket 6.5: Integrate pdfme Designer UI
- [ ] Create TemplateDesigner component
- [ ] Integrate @pdfme/ui Designer component
- [ ] Load template from IndexedDB
- [ ] Allow field editing (add, move, resize, delete)
- [ ] Save updated pdfmeSchema
- [ ] Test designer functionality

**File:** [src/components/template/TemplateDesigner.jsx](my-app/src/components/template/TemplateDesigner.jsx) - NEW

#### Ticket 6.6: PDF Page Rendering Helper
- [ ] Add renderPDFPages(pdfBlob) to pdfjs.service.js
- [ ] Use PDF.js to render each page as ImageData/Canvas
- [ ] Return array of page images
- [ ] Test rendering

**File:** [src/services/pdf/pdfjs.service.js](my-app/src/services/pdf/pdfjs.service.js)

---

### Phase 7: CommonForms Field Detection (Week 9)

**Critical Files:**
- [src/services/ai/onnx.service.js](my-app/src/services/ai/onnx.service.js) - NEW
- [src/workers/onnx.worker.js](my-app/src/workers/onnx.worker.js) - NEW
- [src/components/template/FieldDetector.jsx](my-app/src/components/template/FieldDetector.jsx) - NEW

#### Ticket 7.1: ONNX Runtime Service
- [ ] Create onnx.service.js
- [ ] Implement loadModel(modelBlob)
- [ ] Create InferenceSession with WASM backend
- [ ] Implement detectFormFields(pageImage)
- [ ] Implement preprocessImage(imageData) → tensor
- [ ] Implement parseDetections(results) → bounding boxes
- [ ] Test with sample PDF page images

**File:** [src/services/ai/onnx.service.js](my-app/src/services/ai/onnx.service.js)

#### Ticket 7.2: Download CommonForms Model
- [ ] Add CommonForms model to available models in constants
- [ ] Model URL: (from CommonForms Web repo)
- [ ] Size: ~50MB
- [ ] Add to ModelDownloader component
- [ ] Store in ai_models IndexedDB store
- [ ] Test download

**Files:**
- [src/utils/constants.js](my-app/src/utils/constants.js)
- [src/components/settings/ModelDownloader.jsx](my-app/src/components/settings/ModelDownloader.jsx)

#### Ticket 7.3: ONNX Web Worker
- [ ] Create onnx.worker.js
- [ ] Import onnx.service
- [ ] Handle 'LOAD_MODEL' message
- [ ] Handle 'DETECT_FIELDS' message
- [ ] Post progress updates
- [ ] Post results or errors
- [ ] Test worker

**File:** [src/workers/onnx.worker.js](my-app/src/workers/onnx.worker.js)

#### Ticket 7.4: pdfme Service - Field Detection
- [ ] Add detectFieldsWithCommonForms(pdfBlob) to pdfme.service.js
- [ ] Render PDF pages as images
- [ ] Send each page to ONNX worker
- [ ] Collect detections from all pages
- [ ] Convert detections to pdfme field schema format
- [ ] Return array of fields with positions, types, confidence
- [ ] Test field detection

**File:** [src/services/pdf/pdfme.service.js](my-app/src/services/pdf/pdfme.service.js)

#### Ticket 7.5: Build Field Detector Component
- [ ] Create FieldDetector component
- [ ] Show PDF preview with detected fields overlaid
- [ ] Draw bounding boxes on detected regions
- [ ] Show field type and confidence for each detection
- [ ] Add "Run Detection" button
- [ ] Show loading state during detection
- [ ] Save detected fields to template.detectedFields
- [ ] Test visualization

**File:** [src/components/template/FieldDetector.jsx](my-app/src/components/template/FieldDetector.jsx)

#### Ticket 7.6: Field Type Mapping
- [ ] Add mapFieldType(commonFormsType) to pdfme.service.js
- [ ] Map CommonForms types to pdfme types:
  - text → text
  - checkbox → check
  - date → date
  - signature → signature
- [ ] Test mapping

**File:** [src/services/pdf/pdfme.service.js](my-app/src/services/pdf/pdfme.service.js)

---

### Phase 8: AI-Assisted Field Mapping (Week 10)

**Critical Files:**
- [src/services/pdf/fieldMapping.service.js](my-app/src/services/pdf/fieldMapping.service.js) - NEW
- [src/components/template/MappingEditor.jsx](my-app/src/components/template/MappingEditor.jsx) - NEW
- [src/components/template/ConfidenceIndicator.jsx](my-app/src/components/template/ConfidenceIndicator.jsx) - NEW
- [src/pages/TemplateMappingWorkflow.jsx](my-app/src/pages/TemplateMappingWorkflow.jsx) - NEW

#### Ticket 8.1: Field Mapping Service - Fuzzy Matching
- [ ] Create fieldMapping.service.js
- [ ] Implement fuzzyMatch(str1, str2) using Levenshtein distance
- [ ] Implement normalize(str) to handle synonyms:
  - name → fullName, full_name, applicant_name
  - passport → passportNumber, passport_no, passport_id
  - address → property_address, mailing_address
- [ ] Return similarity score 0-1
- [ ] Test with various field name combinations

**File:** [src/services/pdf/fieldMapping.service.js](my-app/src/services/pdf/fieldMapping.service.js)

#### Ticket 8.2: WebLLM Field Mapping Suggestions
- [ ] Add suggestFieldMapping(templateFields, extractedData) to webllm.service.js
- [ ] Create system prompt for field mapping
- [ ] Use JSON mode for response
- [ ] Return array: [{ templateField, documentField, confidence }]
- [ ] Test with sample data

**File:** [src/services/ai/webllm.service.js](my-app/src/services/ai/webllm.service.js)

#### Ticket 8.3: Field Mapping Service - Auto-Mapping
- [ ] Add autoMapFields(templateFields, extractedData) to fieldMapping.service.js
- [ ] Get AI suggestions from WebLLM
- [ ] Enhance with fuzzy matching scores
- [ ] Combine AI confidence + fuzzy score: (ai + fuzzy) / 2
- [ ] Sort by confidence descending
- [ ] Return enhanced mappings
- [ ] Test auto-mapping accuracy

**File:** [src/services/pdf/fieldMapping.service.js](my-app/src/services/pdf/fieldMapping.service.js)

#### Ticket 8.4: Field Mapping Storage
- [ ] Create fieldMappingStorage.service.js
- [ ] Implement saveMappings(templateId, clientId, mappings)
- [ ] Implement getMappings(templateId, clientId)
- [ ] Implement updateMappings(mappingId, updates)
- [ ] Test storage operations

**File:** [src/services/storage/fieldMappingStorage.service.js](my-app/src/services/storage/fieldMappingStorage.service.js) - NEW

#### Ticket 8.5: Build Confidence Indicator Component
- [ ] Create ConfidenceIndicator component
- [ ] Show confidence as percentage
- [ ] Color-code: >80% green, 50-80% yellow, <50% red
- [ ] Add progress bar visualization
- [ ] Test with different confidence values

**File:** [src/components/template/ConfidenceIndicator.jsx](my-app/src/components/template/ConfidenceIndicator.jsx)

#### Ticket 8.6: Build Mapping Editor Component
- [ ] Create MappingEditor component
- [ ] Left panel: Template fields (drop targets)
- [ ] Right panel: Extracted data fields (draggable)
- [ ] Bottom panel: AI suggestions (with confidence scores)
- [ ] Implement drag-and-drop mapping
- [ ] Show current mappings with confidence indicators
- [ ] Add "Accept" button for AI suggestions
- [ ] Add "Clear Mapping" button
- [ ] Auto-accept suggestions with confidence > 0.7
- [ ] Test drag-drop functionality

**File:** [src/components/template/MappingEditor.jsx](my-app/src/components/template/MappingEditor.jsx)

#### Ticket 8.7: Build Template Mapping Workflow Page
- [ ] Create TemplateMappingWorkflow component
- [ ] Step 1: Select template
- [ ] Step 2: Select client/documents (to get extracted data)
- [ ] Step 3: Run auto-mapping
- [ ] Step 4: Show MappingEditor
- [ ] Step 5: Save mappings
- [ ] Add navigation buttons (Next, Back, Save)
- [ ] Test full workflow

**File:** [src/pages/TemplateMappingWorkflow.jsx](my-app/src/pages/TemplateMappingWorkflow.jsx)

#### Ticket 8.8: Mapping Validation
- [ ] Add validateMapping(mapping, templateSchema, dataSchema) to fieldMapping.service.js
- [ ] Check type compatibility (string field → string data)
- [ ] Check required fields are mapped
- [ ] Return validation errors
- [ ] Show errors in MappingEditor
- [ ] Test validation

**File:** [src/services/pdf/fieldMapping.service.js](my-app/src/services/pdf/fieldMapping.service.js)

---

### Phase 9: PDF Generation (Week 11)

**Critical Files:**
- [src/components/template/PDFGenerator.jsx](my-app/src/components/template/PDFGenerator.jsx) - NEW
- [src/hooks/usePDFGeneration.js](my-app/src/hooks/usePDFGeneration.js) - NEW

#### Ticket 9.1: pdfme Service - PDF Generation
- [ ] Add generatePDF(template, mappedData) to pdfme.service.js
- [ ] Use @pdfme/generator to fill template
- [ ] Return PDF as Blob
- [ ] Test PDF generation

**File:** [src/services/pdf/pdfme.service.js](my-app/src/services/pdf/pdfme.service.js)

#### Ticket 9.2: Data Mapping Application
- [ ] Add applyMappings(mappings, extractedData) to fieldMapping.service.js
- [ ] Transform extractedData into template field format
- [ ] Use mappings array to map documentField → templateField
- [ ] Return mapped data object ready for pdfme
- [ ] Test data transformation

**File:** [src/services/pdf/fieldMapping.service.js](my-app/src/services/pdf/fieldMapping.service.js)

#### Ticket 9.3: usePDFGeneration Hook
- [ ] Create usePDFGeneration.js hook
- [ ] Implement generatePDF(templateId, clientId)
- [ ] Load template and mappings
- [ ] Load client's extracted data
- [ ] Apply mappings
- [ ] Generate PDF via pdfme
- [ ] Track generation status
- [ ] Return { generatePDF, status, pdfBlob }

**File:** [src/hooks/usePDFGeneration.js](my-app/src/hooks/usePDFGeneration.js)

#### Ticket 9.4: Build PDF Generator Component
- [ ] Create PDFGenerator component
- [ ] Add "Generate PDF" button
- [ ] Show loading state during generation
- [ ] Preview generated PDF (use PDF.js viewer)
- [ ] Add "Download" button
- [ ] Add "Regenerate" button
- [ ] Show generation errors
- [ ] Test generation flow

**File:** [src/components/template/PDFGenerator.jsx](my-app/src/components/template/PDFGenerator.jsx)

#### Ticket 9.5: PDF Download Handler
- [ ] Create downloadPDF(pdfBlob, filename) utility
- [ ] Create object URL from blob
- [ ] Trigger browser download
- [ ] Clean up object URL
- [ ] Test download

**File:** [src/utils/fileHelpers.js](my-app/src/utils/fileHelpers.js)

#### Ticket 9.6: PDF Preview Modal
- [ ] Create PDFPreview component
- [ ] Use PDF.js to render PDF in modal
- [ ] Add zoom controls
- [ ] Add page navigation (for multi-page PDFs)
- [ ] Add "Close" button
- [ ] Test preview

**File:** [src/components/common/PDFPreview.jsx](my-app/src/components/common/PDFPreview.jsx) - NEW

#### Ticket 9.7: Batch PDF Generation
- [ ] Add generateBatchPDFs(templateId, clientIds) to pdfme.service.js
- [ ] Loop through clients
- [ ] Generate PDF for each
- [ ] Collect all PDFs
- [ ] Create ZIP file (use JSZip library)
- [ ] Download ZIP
- [ ] Test batch generation

**Dependencies:**
```bash
npm install jszip
```

**File:** [src/services/pdf/pdfme.service.js](my-app/src/services/pdf/pdfme.service.js)

#### Ticket 9.8: Integration with Mapping Workflow
- [ ] Add PDFGenerator to TemplateMappingWorkflow page
- [ ] Step 6: Generate and preview PDF
- [ ] Test end-to-end: upload docs → extract → map → generate
- [ ] Validate full workflow

**File:** [src/pages/TemplateMappingWorkflow.jsx](my-app/src/pages/TemplateMappingWorkflow.jsx)

---

### Phase 10: PWA & Polish (Week 12)

**Critical Files:**
- [public/manifest.json](my-app/public/manifest.json) - MODIFY
- [public/service-worker.js](my-app/public/service-worker.js) - NEW
- [src/components/common/StorageMonitor.jsx](my-app/src/components/common/StorageMonitor.jsx) - NEW
- [src/services/storage/quota.service.js](my-app/src/services/storage/quota.service.js) - NEW

#### Ticket 10.1: PWA Manifest Configuration
- [ ] Update manifest.json
- [ ] Add app name, description, icons
- [ ] Set theme_color, background_color
- [ ] Set display: "standalone"
- [ ] Set start_url: "/"
- [ ] Add shortcuts to common actions
- [ ] Test manifest with Chrome DevTools

**File:** [public/manifest.json](my-app/public/manifest.json)

#### Ticket 10.2: Service Worker Implementation
- [ ] Create service-worker.js
- [ ] Cache app shell (HTML, CSS, JS)
- [ ] Cache UI assets (icons, fonts)
- [ ] Implement offline fallback page
- [ ] Use Cache-First strategy for static assets
- [ ] Use Network-First strategy for API calls (none in this app)
- [ ] Register service worker in index.html
- [ ] Test offline functionality

**File:** [public/service-worker.js](public/service-worker.js)

#### Ticket 10.3: Storage Quota Service
- [ ] Create quota.service.js
- [ ] Implement getStorageEstimate()
- [ ] Implement checkQuotaWarning()
- [ ] Return usage percentage, MB used/available
- [ ] Return warning levels: normal, warning (60%), critical (80%)
- [ ] Test quota calculations

**File:** [src/services/storage/quota.service.js](my-app/src/services/storage/quota.service.js)

#### Ticket 10.4: Storage Monitor Component
- [ ] Create StorageMonitor component
- [ ] Display storage usage bar
- [ ] Show MB used / MB available
- [ ] Color-code: green (<60%), yellow (60-80%), red (>80%)
- [ ] Add "Clear Old Data" button
- [ ] Show warning toast at 60%, 80%
- [ ] Add to Settings page and Header
- [ ] Test quota monitoring

**File:** [src/components/common/StorageMonitor.jsx](my-app/src/components/common/StorageMonitor.jsx)

#### Ticket 10.5: Data Export Feature
- [ ] Create dataExport.js utility
- [ ] Implement exportClientData(clientId)
- [ ] Export client + documents + mappings as JSON
- [ ] Exclude large fileBlobs
- [ ] Trigger download
- [ ] Test export

**File:** [src/utils/dataExport.js](my-app/src/utils/dataExport.js) - NEW

#### Ticket 10.6: Data Import Feature
- [ ] Add importClientData(jsonFile) to dataExport.js
- [ ] Parse JSON
- [ ] Validate structure
- [ ] Import into IndexedDB
- [ ] Handle duplicate clients
- [ ] Show success/error messages
- [ ] Test import

**File:** [src/utils/dataExport.js](my-app/src/utils/dataExport.js)

#### Ticket 10.7: Loading Skeletons
- [ ] Create Skeleton component
- [ ] Add skeletons to:
  - ClientList (while loading clients)
  - DocumentList (while loading documents)
  - TemplateList (while loading templates)
  - ExtractionResults (while processing)
- [ ] Test loading states

**File:** [src/components/common/Skeleton.jsx](my-app/src/components/common/Skeleton.jsx) - NEW

#### Ticket 10.8: Error Boundary Component
- [ ] Create ErrorBoundary component
- [ ] Catch React errors
- [ ] Display user-friendly error message
- [ ] Add "Reload App" button
- [ ] Log errors to console
- [ ] Wrap App component with ErrorBoundary
- [ ] Test error handling

**File:** [src/components/common/ErrorBoundary.jsx](my-app/src/components/common/ErrorBoundary.jsx) - NEW

#### Ticket 10.9: Toast Notification System
- [ ] Use shadcn/ui Toast component
- [ ] Create useToast hook
- [ ] Show toasts for:
  - Success: "Client created", "PDF generated"
  - Error: "Model download failed", "Extraction error"
  - Warning: "Storage 80% full"
  - Info: "Processing started"
- [ ] Test toast notifications

**File:** [src/hooks/useToast.js](my-app/src/hooks/useToast.js) - NEW

#### Ticket 10.10: Offline Indicator
- [ ] Create OfflineIndicator component
- [ ] Listen to navigator.onLine
- [ ] Show banner when offline: "You're offline. Changes will sync when reconnected."
- [ ] Hide when online
- [ ] Test online/offline transitions

**File:** [src/components/common/OfflineIndicator.jsx](my-app/src/components/common/OfflineIndicator.jsx) - NEW

#### Ticket 10.11: Performance Optimization
- [ ] Implement code splitting for routes (React.lazy)
- [ ] Lazy load pdfme Designer
- [ ] Optimize images (compress icons)
- [ ] Run Lighthouse audit
- [ ] Target: Performance score 90+
- [ ] Fix any issues

#### Ticket 10.12: Accessibility Audit
- [ ] Run WAVE or axe DevTools
- [ ] Fix color contrast issues (WCAG AA: 4.5:1)
- [ ] Add ARIA labels to interactive elements
- [ ] Ensure keyboard navigation works
- [ ] Add skip links
- [ ] Test with screen reader
- [ ] Target: WCAG 2.1 AA compliance

#### Ticket 10.13: User Documentation
- [ ] Create README.md with:
  - Overview of features
  - Browser requirements (Chrome/Edge 113+)
  - First-time setup guide
  - Workflow explanation
  - Troubleshooting common issues
- [ ] Add in-app help tooltips
- [ ] Test documentation clarity

**File:** [README.md](my-app/README.md) - NEW

---

## Critical Success Factors

### 1. Browser Compatibility
- **Strict requirement:** Chrome 113+ or Edge 113+ with WebGPU
- Implement capability detection on app load
- Redirect to unsupported page if requirements not met

### 2. Model Selection
- **Default:** Phi-3-mini (1.6GB) - best balance of speed and accuracy
- Allow user selection in settings
- Download on first launch via onboarding wizard

### 3. Web Workers
- Use workers for ALL heavy processing:
  - WebLLM inference
  - OCR
  - PDF text extraction
  - ONNX field detection
- Prevents UI blocking and improves UX

### 4. Storage Management
- Monitor quota proactively
- Show warnings at 60%, 80%
- Implement cleanup policies (delete old jobs, compress data)
- Offer export/archive features

### 5. Error Handling
- Graceful degradation for unsupported features
- Clear error messages for users
- Retry mechanisms for network failures
- Error boundaries to prevent crashes

### 6. Performance
- Code splitting by route
- Lazy loading for heavy components (pdfme designer)
- Optimize bundle size (<500KB initial)
- Use virtual scrolling for large lists

---

## Testing Checklist

### Unit Tests
- [ ] IndexedDB CRUD operations
- [ ] Field mapping fuzzy matching
- [ ] Schema validation
- [ ] File type detection

### Integration Tests
- [ ] Document upload → extraction → storage
- [ ] Template upload → field detection → mapping
- [ ] Full pipeline: upload → extract → classify → map → generate PDF

### E2E Tests (Playwright/Cypress)
- [ ] Onboarding wizard flow
- [ ] Create client and upload documents
- [ ] Process documents with AI
- [ ] Create template and map fields
- [ ] Generate final PDF

### Performance Tests
- [ ] Model download time
- [ ] Classification time per document type
- [ ] Extraction time per document type
- [ ] PDF generation time
- [ ] Storage read/write speeds

### Accessibility Tests
- [ ] Keyboard navigation
- [ ] Screen reader compatibility
- [ ] Color contrast (WCAG AA)
- [ ] Focus indicators

---

## Deployment

### Hosting Options
- **Recommended:** Vercel, Netlify, or Cloudflare Pages
- Static site hosting (no backend needed)
- Automatic HTTPS
- CDN for fast delivery

### Build Command
```bash
npm run build
```

### Environment Variables
None required (fully client-side)

### Pre-Deployment Checklist
- [ ] Run production build locally and test
- [ ] Lighthouse audit (score 90+)
- [ ] Test on Chrome 113+, Edge 113+
- [ ] Verify service worker works offline
- [ ] Test PWA installation
- [ ] Verify all features work in production build

---

## Future Enhancements (Post-Launch)

### Phase 11+: Advanced Features
- Multi-language support (i18next)
- Multi-language OCR
- Handwritten text recognition
- Table extraction from PDFs
- Collaborative features (export/import between users)
- Custom document type schemas
- User feedback loop for extraction accuracy
- Mobile app (React Native)
- Desktop app (Electron)
- Batch processing for entire folders
- Conditional logic in field mappings
- Multi-document mapping (combine data from multiple sources)

---

## Summary

This implementation plan provides:
- **12-week phased rollout** with clear milestones
- **MVP by Week 7** (document extraction + AI classification)
- **Full feature set by Week 11** (PDF generation with mapping)
- **Production-ready PWA by Week 12**

Each phase builds on the previous, with clear dependencies and deliverables. The ticket-based approach allows for parallel work where possible and ensures all critical functionality is covered.

**Key Technical Highlights:**
- Vite for modern build system
- Zustand for lightweight state management
- Web Workers prevent UI blocking
- IndexedDB for robust local storage
- shadcn/ui for accessible components
- WebLLM + ONNX Runtime for local AI
- pdfme for PDF template handling

The architecture is scalable, maintainable, and privacy-focused (100% client-side processing).